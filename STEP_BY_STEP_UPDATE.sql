-- ===================================
-- ุชุญุฏูุซ ูุฏูู ุฎุทูุฉ ุจุฎุทูุฉ
-- ===================================
-- ุงูุณุฎ ูู ุฎุทูุฉ ุนูู ุญุฏุฉ ูุดุบูููุง ูู Supabase SQL Editor
-- ===================================

-- ===================================
-- ๐ ุงูุฎุทูุฉ 1: ุนุฑุถ ุฌููุน ุงููุทุน ุงููุชุงุญุฉ
-- ===================================

SELECT 
    id,
    serial_number as "ุจุงุฑ ููุฏ",
    product_id as "ูุนุฑู ุงูููุชุฌ",
    cost_price as "ุงูุชูููุฉ",
    TO_CHAR(purchase_date, 'YYYY-MM-DD HH24:MI') as "ุชุงุฑูุฎ ุงูุงุณุชูุงู",
    supplier_id as "ุงูููุฑุฏ",
    destination_client_id as "ุงูุนููู",
    purchase_reason as "ุณุจุจ ุงูุดุฑุงุก"
FROM inventory_items
WHERE bundle_group_id IS NULL  -- ููุท ุงููุทุน ุงูุชู ููุณุช ูู ุญุฒูุฉ
AND purchase_date >= '2024-01-01'  -- โ๏ธ ุนุฏูู ุงูุชุงุฑูุฎ ุญุณุจ ุงูุญุงุฌุฉ
ORDER BY purchase_date DESC, supplier_id
LIMIT 50;

-- ๐ ููุงุญุธุฉ: ุงุจุญุซ ุนู ุงููุทุน ุงูุชู:
-- โ ููุณ ุงูุชุงุฑูุฎ (ุฃู ูุฑูุจุฉ ุฌุฏุงู)
-- โ ููุณ ุงูููุฑุฏ
-- โ ููุณ ุงูุนููู
-- โ ููุณ ุณุจุจ ุงูุดุฑุงุก

-- ===================================
-- ๐ฆ ุงูุฎุทูุฉ 2: ูุนุฑูุฉ ุฃุณูุงุก ุงูููุชุฌุงุช
-- ===================================

SELECT 
    i.serial_number as "ุจุงุฑ ููุฏ",
    p.name as "ุงุณู ุงูููุชุฌ",
    p.sku as "SKU",
    i.cost_price as "ุงูุชูููุฉ",
    TO_CHAR(i.purchase_date, 'YYYY-MM-DD HH24:MI') as "ุงูุชุงุฑูุฎ"
FROM inventory_items i
JOIN products p ON p.id = i.product_id
WHERE i.serial_number IN (
    'ุฑูู_1',  -- โ๏ธ ุงุณุชุจุฏู ุจุงูุฃุฑูุงู ูู ุงูุฎุทูุฉ 1
    'ุฑูู_2',
    'ุฑูู_3',
    'ุฑูู_4'
)
ORDER BY i.purchase_date;

-- ๐ ููุงุญุธุฉ: ุชุฃูุฏ ุฃู ูุฐู ุงููุทุน ุชุดูู ุญุฒูุฉ ูุงุญุฏุฉ

-- ===================================
-- โ ุงูุฎุทูุฉ 3: ุชุญุฏูุซ ุงูุญุฒูุฉ ุงูุฃููู
-- ===================================

UPDATE inventory_items
SET 
    bundle_group_id = 'bundle_pos_001',  -- ูุนุฑู ูุฑูุฏ ููุญุฒูุฉ
    bundle_name = 'ููุทุฉ ุจูุน ูุงููุฉ POS'
WHERE serial_number IN (
    'ุฑูู_1',  -- โ๏ธ ุงุณุชุจุฏู ุจุงูุฃุฑูุงู ุงูุญููููุฉ ูู ุงูุฎุทูุฉ 1
    'ุฑูู_2',
    'ุฑูู_3',
    'ุฑูู_4'
);

-- ๐ ุงููุชูุฌุฉ ุงููุชููุนุฉ: UPDATE 4 (ุฃู ุนุฏุฏ ุงููุทุน)

-- ===================================
-- ๐ ุงูุฎุทูุฉ 4: ุงูุชุญูู ูู ุงููุชูุฌุฉ
-- ===================================

SELECT 
    bundle_group_id as "ูุนุฑู ุงูุญุฒูุฉ",
    bundle_name as "ุงุณู ุงูุญุฒูุฉ",
    serial_number as "ุจุงุฑ ููุฏ",
    cost_price as "ุงูุชูููุฉ",
    TO_CHAR(purchase_date, 'YYYY-MM-DD') as "ุงูุชุงุฑูุฎ"
FROM inventory_items
WHERE bundle_group_id = 'bundle_pos_001'  -- โ๏ธ ุงุณุชุจุฏู ุจุงููุนุฑู ุงูุฐู ุงุณุชุฎุฏูุชู
ORDER BY purchase_date;

-- ๐ ูุฌุจ ุฃู ุชุฑู ุฌููุน ุงููุทุน ูุน ููุณ bundle_group_id

-- ===================================
-- ๐ ุงูุฎุทูุฉ 5: ููุฎุต ุงูุญุฒูุฉ
-- ===================================

SELECT 
    bundle_group_id as "ูุนุฑู ุงูุญุฒูุฉ",
    bundle_name as "ุงุณู ุงูุญุฒูุฉ",
    COUNT(*) as "ุนุฏุฏ ุงููุทุน",
    SUM(cost_price) as "ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ",
    TO_CHAR(MIN(purchase_date), 'YYYY-MM-DD') as "ุชุงุฑูุฎ ุงูุงุณุชูุงู",
    STRING_AGG(serial_number, ', ' ORDER BY serial_number) as "ุงูุฃุฑูุงู ุงูุชุณูุณููุฉ"
FROM inventory_items
WHERE bundle_group_id = 'bundle_pos_001'
GROUP BY bundle_group_id, bundle_name;

-- ๐ ุงููุชูุฌุฉ ุงููุชููุนุฉ: ุตู ูุงุญุฏ ูุญุชูู ุนูู ููุฎุต ุงูุญุฒูุฉ

-- ===================================
-- ๐ ุงูุฎุทูุฉ 6: ุชุญุฏูุซ ุญุฒูุฉ ุซุงููุฉ (ุฅุฐุง ูุฌุฏุช)
-- ===================================

-- ูุฑุฑ ุงูุฎุทูุงุช 1-5 ูุน ูุนุฑู ูุฎุชูู:

UPDATE inventory_items
SET 
    bundle_group_id = 'bundle_pos_002',  -- โ๏ธ ูุนุฑู ูุฎุชูู!
    bundle_name = 'ููุทุฉ ุจูุน ูุงููุฉ POS'
WHERE serial_number IN (
    'ุฑูู_5',  -- โ๏ธ ุฃุฑูุงู ุงูุญุฒูุฉ ุงูุซุงููุฉ
    'ุฑูู_6',
    'ุฑูู_7',
    'ุฑูู_8'
);

-- ===================================
-- ๐ ุงูุฎุทูุฉ 7: ุนุฑุถ ุฌููุน ุงูุญุฒู
-- ===================================

SELECT 
    bundle_group_id as "ูุนุฑู ุงูุญุฒูุฉ",
    bundle_name as "ุงุณู ุงูุญุฒูุฉ",
    COUNT(*) as "ุนุฏุฏ ุงููุทุน",
    SUM(cost_price) as "ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ",
    TO_CHAR(MIN(purchase_date), 'YYYY-MM-DD') as "ุชุงุฑูุฎ ุงูุงุณุชูุงู"
FROM inventory_items
WHERE bundle_name = 'ููุทุฉ ุจูุน ูุงููุฉ POS'
GROUP BY bundle_group_id, bundle_name
ORDER BY MIN(purchase_date) DESC;

-- ๐ ูุฌุจ ุฃู ุชุฑู ุฌููุน ุญุฒู POS ุงููุญุฏุซุฉ

-- ===================================
-- ๐ ุงูุชุฑุงุฌุน (ุฅุฐุง ุญุฏุซ ุฎุทุฃ)
-- ===================================

-- ุฅูุบุงุก ุชุญุฏูุซ ุญุฒูุฉ ูุนููุฉ:
-- UPDATE inventory_items
-- SET 
--     bundle_group_id = NULL,
--     bundle_name = NULL
-- WHERE bundle_group_id = 'bundle_pos_001';

-- ุฅูุบุงุก ุฌููุน ุญุฒู POS:
-- UPDATE inventory_items
-- SET 
--     bundle_group_id = NULL,
--     bundle_name = NULL
-- WHERE bundle_name = 'ููุทุฉ ุจูุน ูุงููุฉ POS';

-- ===================================
-- โ ุงูุชูู!
-- ===================================

/*
๐ ููุฎุต ุงูุฎุทูุงุช:
1. ุนุฑุถ ุงููุทุน ุงููุชุงุญุฉ
2. ูุนุฑูุฉ ุฃุณูุงุก ุงูููุชุฌุงุช
3. ุชุญุฏูุซ ุงูุญุฒูุฉ
4. ุงูุชุญูู ูู ุงููุชูุฌุฉ
5. ุนุฑุถ ููุฎุต ุงูุญุฒูุฉ
6. ุชุญุฏูุซ ุญุฒู ุฅุถุงููุฉ (ุฅุฐุง ูุฌุฏุช)
7. ุนุฑุถ ุฌููุน ุงูุญุฒู

โ๏ธ ูุตุงุฆุญ:
- ุงุณุชุฎุฏู ูุนุฑู ูุฑูุฏ ููู ุญุฒูุฉ
- ุชุญูู ูู ุงููุชุงุฆุฌ ูุจู ุงููุชุงุจุนุฉ
- ููููู ุงูุชุฑุงุฌุน ุจุณูููุฉ ุฅุฐุง ุญุฏุซ ุฎุทุฃ
*/
